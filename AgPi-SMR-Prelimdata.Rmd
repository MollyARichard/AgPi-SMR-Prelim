---
title: <center>"Metabolic and Stress Physiology of Cottonmouth Snakes, *Agkistrodon
  piscivorous*"</center>
author: "<center> Molly Richard </center>"
output:
  html_document:
    df_print: paged
    toc: yes
  html_notebook:
    df_print: paged
    highlight: breezedark
    number_sections: no
    rows.print: 10
    theme: cosmo
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,	message = FALSE,	warning = FALSE)

library(dplyr)
library(ggplot2)
library(readr)
library(tidyr)
library(knitr)
library(tmap)
library(leaflet)
packages<-c("ggsn","leaflet","mapdata","maptools","OpenStreetMap","rgdal","smoothr","sf","sp","tidyverse","tmap")
sapply(packages, require, character.only=T)

#import data
data <- read_csv("prelimdata.csv")
```

```{r Clean up data, include=FALSE}
data <- slice(data, -29)
data <- within(data, SMR_Hour <- Average_MR_min*60)

#Include random values for CORT levels 
#rnmin <- data.frame(floor(runif(55, min = 10, max = 50)))
#names(rnmin) <- c("CORTmin")
#rnmin<-arrange(rnmin, CORTmin)
#rnmax <- data.frame(floor(runif(55, min = 55, max = 200)))
#names(rnmax) <- c("CORTmax")
#rnmax<-arrange(rnmax, CORTmax)
#rn <- cbind(rnmin, rnmax)
#rn$CORTresp<- NA
#rn <- within(rn, CORTresp <- CORTmax-CORTmin)

#data <- arrange(data, Mass_g)
#data <- cbind(data, rn)
```

## Introduction

## Objectives 
The objectives of this study are to gain an understanding of the relationship between metabolism and CORT levels by comparing stress-induced changes in CORT with standard metabolic rates in cottonmouth snakes. Cottonmouths are a good species to investigate this relationship because they display a conspicuous behavioral threat (stress) response that is indicative of stress, the open-mouth bite-threat (Figure 1).

## Methods 
### Field Collection and Husbandry 
Cottonmouth snakes (n=56) were collected opportunistically from May to October 2019 from a back-water slough formed by the Cumberland River and Sycamore Creek in Cheatham County, Tennessee. Blood samples were collected in the field (see below) before snakes were transported back to the lab to be housed in individual cages with a temperature gradient of 24-30°C and a 12:12 hour photoperiod (light:dark). Snakes were provided with water ad libitum, a size-appropriate hide box, and heat pad. 

### Field Site
```{r}
state<- map_data("state")
county <- map_data("county")
swamp_point <- data.frame("x" = -87.098818, "y" =  36.291807)

tn <- county %>% 
  filter(region=="tennessee")

chco <- county %>% 
  filter(region=="tennessee") %>% 
  filter(subregion=="cheatham")

ggplot() + geom_polygon(data = state, aes(x=long, y = lat, group = group),
                        fill = "white", color="black") + 
           geom_polygon(data = tn, aes(x=long, y = lat, group = group),
                        fill = "gray", color="black") + 
           geom_polygon(data = chco, aes(x=long, y = lat, group = group),
                        fill = "red", color="black") + 
           geom_point(data = swamp_point, aes(x=x,y=y), color="black") +
  coord_fixed(xlim = c(-90, -82),  ylim = c(35, 36.7), ratio = 1) + 
  xlab("Longitude") + ylab("Latitude") + ggtitle("The Swamp, Cheatham Co., TN")

ggplot() + geom_polygon(data = chco, aes(x=long, y = lat, group = group),fill = "white", color="black") + 
           geom_point(data = swamp_point, aes(x=x,y=y), color="black", size =5) +
  coord_fixed(xlim = c(-87.4, -86.8),  ylim = c(36, 36.5), ratio = 1) + 
  xlab("Longitude") + ylab("Latitude") + ggtitle("The Swamp, Cheatham Co., TN")

```


### Capture locations
```{r Leaflet map}
#Provider tiles from http://leaflet-extras.github.io/leaflet-providers/preview/index.html
pal <- colorFactor(palette =c("blue", "red"), levels = c("M", "F"))

leaflet(data) %>%
  addProviderTiles("Esri.WorldImagery", group = "ESRI") %>%
  addCircleMarkers (lng = ~Longitude, lat = ~Latitude, 
  label = ~as.character(Temp_Snake_ID), color = ~pal(Sex), radius = 5)%>%
  addLegend("bottomright", pal = pal, title = "Sex", values = ~Sex)
  
```

### Blood sampling and ELISA assays
Snakes were captured using tongs and tubed before collecting a blood sample to analyze circulating CORT levels from the caudal vein on average with in ___min ± ___ (range __m-__ m) of initial contact (baseline level). The snakes were placed in a cloth bag to induce stress before a second blood sample was collected one hour after the initial sample (stress level, range __m-__m).  100-200 μl of blood was drawn from the caudal vein for each sample using a 1 ml heparinized syringe with a 25-gauge needle. Samples were stored in microcentrifuge tubes and placed on ice immediately following collection until transported back to the lab within 5 hours. Whole blood was centrifuged immediately upon return and plasma stored in 1.5ml microcentrifuge tubes at -80°C until assayed. ELISA corticosterone assay kits (900-097, Enzo Life Sciences Inc., Farmingdale, NY) were used to analyze the baseline and stress plasma samples.  Analysis procedures are based off previous studies conducted by Bailey et al (2009) and Sykes and Klukowski (2009).  Plasma and kit solutions were thawed to room temperature before aliquoting 20 μl plasma into microfuge tube. The Steroid Displacement Reagent (SDR) was prepared to manufacture’s specifications in a 1:100 solution of 1 ml of reagent to 100 ml of deionized water. 20 μl SDR was added to the microfuge tube and allow to sit for 10 minutes at room temperature. 560 μl assay buffer was added to the samples to create a 30-fold dilution effect.  Samples were rinsed to remove excess reagents and p-nitrophenyl phosphate substrate was added before being incubated for 60 min. The color created by the enzyme reaction ceased and was read by a spectrometer (Molecular Devices Optimax microplate reader) at 405 nm.   

### Respirometry
Snakes were housed for a minimum of 7 seven days prior to undergoing metabolic measurements to ensure a post-absorptive state. An open-flow respirometry system was used to determine individuals’ metabolic rates by measuring rates of oxygen consumption (VO2) (Withers 2001, Lighton 2008).  Individuals were weighed and placed in a size appropriate plexiglass chambers varying in size from 1.2 L to _____. Chambers were placed in a Percival Scientific incubator to maintain a constant temperature of 25°C and 12:12 hour (light:dark) photoperiod during the trials. An Ametek R-1 flow controller pumped room air through a Drierite drying column before air flow was allocated between 5 lines using a Sierra Instruments Top Trak and Smart Trak mass flow meters. The mass flow meters maintain predetermined air flow rates (15 to 160 mL/min) based on the size of the snake (Spencer et al). Four snakes were measured sequentially for 30 minutes each with a 15-minute baseline between chambers using a Sable Systems MUX flow multiplexer over the course of 72 hours. Air was then scrubbed of water vapor and CO2 using Drierite and Ascarite II drying columns. Air flow passed through another mass flow meter serving as a check on the predetermined flow rate before entering the Sable Systems FC-10 oxygen analyzer which was connected to a laptop computer recording O2 measurements every 3 seconds. Each snake was measured 8 times over a 24-hour period, and the most level 15 minutes of each 30-minute sample period was used to calculate the rate of gas exchange (Withers 1977) using LabAnalyst (Warthog Systems, http://warthog.ucr.edu). The mean of the three lowest 15-minute measures during the trial period was determined to be the Standard Metabolic Rate (SMR) in place of using the lowest measurement to avoid periods of apnea (Heatwole 1977). 

## Preliminary data analysis

### Graphs of SMR and Mass
```{r}
ggplot(data, aes(x= Mass_g , y= SMR_Hour))+
  geom_point(aes(size = 10))+
  geom_smooth(method = "lm") +
  xlab("Body Mass (g)") + ylab("Oxygen Consumption (mL O2 hour-1)")+
  theme_bw(base_size = 10)+
  theme(legend.position = "none")
lmtest <- lm(SMR_Hour ~ Mass_g, data = data)
anova <- anova(lmtest)
summary(lmtest)
coef(lmtest)


ggplot(data, aes(x= log(Mass_g) , y= log(SMR_Hour)))+
  geom_point(aes(size = 10))+
  geom_smooth(method = "lm") +
  xlab("Log Body Mass (g)") + ylab("Log Oxygen Consumption (mL O2 hour-1)")+
  theme_bw(base_size = 10)+
  theme(legend.position = "none")
```

### Remove the outlier 

```{r remove the beast, echo=FALSE, warning=FALSE}
data1 <- slice(data, -29)
ggplot(data1, aes(x= Mass_g , y= SMR_Hour))+
  geom_point(aes(size = 10))+
  geom_smooth(method="lm") +
  xlab("Body Mass (g)") + ylab("Oxygen Consumption (mL O2 hour-1)")+
  theme_bw(base_size = 10)+
  theme(legend.position = "none")

lm1 <- lm(SMR_Hour ~ Mass_g, data = data1)
anova1 <- anova(lm1)
summary(lm1)
coef(lm1)
```

### Males vs. Females
```{r Graph all males and females, message=FALSE, warning=FALSE}

ggplot(data, aes(x= Mass_g , y= SMR_Hour, shape=Sex, lty = Sex))+
  geom_point(aes(size = 10))+
  geom_smooth(method = "lm") +
  xlab("Body Mass (g)") + ylab("Oxygen Consumption (mL O2 hour-1)")+
  theme_bw(base_size = 10)+
  theme(legend.position = "none")
lm <- lm(SMR_Hour ~ Mass_g + Sex, data = data)
anova <- anova(lm)
summary(lm)
```

### Shedding vs Non-shedding individuals
```{r Shedding vs not shedding, echo=FALSE, warning=FALSE}
ggplot(data, aes(x= Mass_g , y= SMR_Hour, shape=Shedding_Chamber, lty = Shedding_Chamber))+
  geom_point(aes(size = 10))+
  geom_smooth(method = "lm") +
  xlab("Body Mass (g)") + ylab("Oxygen Consumption (mL O2 hour-1)")+
  theme_bw(base_size = 10)+
  theme(legend.position = "none")

Shed_SMR <- lm(SMR_Hour~ Mass_g + Shedding_Chamber, data = data)
Shed_anova <- anova(Shed_SMR)
summary(Shed_SMR)
```

### Individuals less than 500g
```{r echo=FALSE}
#Subset < 500g
subset_SMR <- filter(data, Mass_g <  500)

ggplot(subset_SMR, aes(x= Mass_g , y= SMR_Hour, shape=Sex, lty = Sex ))+
  geom_point(aes(size = 10))+
  geom_smooth(method="lm") +
  xlab("Body Mass (g)") + ylab("Metabolic Rate (mL O2 hour-1)")+
  theme_bw(base_size = 10)+
  theme(legend.position = "none")

Sub_SMR <- lm(SMR_Hour~ Mass_g +Sex, data = subset_SMR)
Sub_anova <- anova(Sub_SMR)
summary(Sub_SMR)
```






##References
